<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="/eel.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.8.3.min.js"></script>


    <meta charset="utf-8">
    <title></title>


    <script type="text/javascript">
    eel.expose(update_channel)
    function update_channel(R,T,ch){
      var update = {
          x:  [[T]],
          y: [[R]]
          }
          Plotly.extendTraces('data_plot', update, [ch-1])
    }

      eel.expose(send_T_data)
      function send_T_data(T){
        T_div = document.getElementById('current_Temp');
        T_div.innerText = T;
        }
    </script>
  </head>
  <body>
    <div class="gridcontainer">

        <div class="status row-flex rounded border border-secondary bg-light">
          <span class="badge bg-danger" hidden >Not connected</span>
          <span class="badge bg-warning" hidden>Compliance</span>
          <span class="badge bg-success" hidden >Temperature stable</span>
          <span class="badge bg-success">Temperature: <div id="current_Temp"></div> [K]</span>

        </div>

        <div class="plot border rounded bg-light">
          <div id="data_plot"></div>
        </div>

        <script type="text/javascript">
        var graphDiv = document.getElementById('data_plot')
        var data = [{
                    x: [],
                    y: [],
                    type: 'scatter',
                    name: 'ch 1'
                  },
                  {  x: [],
                    y: [],
                    type: 'scatter',
                  name: 'ch 2'},
                    {  x: [],
                      y: [],
                      type: 'scatter',
                    name: 'ch 3'},
                      {  x: [],
                        y: [],
                        type: 'scatter',
                      name: 'ch 4'}
                  ];

                  var layout = {

                    xaxis: {
                      title: 'Temperature',

                      zeroline: false
                    },
                    yaxis: {
                      title: 'Resistance [Ohm]',
                      showline: false
                    }
                  };
                  Plotly.newPlot(graphDiv, data, layout);
        </script>





        <script type="text/javascript">
        function set_transport(){
          current = parseFloat(document.getElementById("Current").value)
          compliance = parseFloat(document.getElementById("Compliance").value)
          nplc = parseFloat(document.getElementById("NPLC").value)

          console.log(current,compliance,nplc)
        }

        </script>

        <div class="resistivity col-flex rounded border border-secondary bg-light">

          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <label for="Current" class="col-form-label">Current</label>
            </div>
            <div class="col-auto">
              <input type="number" id="Current" value=0.1 min=-100 max=100 step=0.01 class="form-control" aria-describedby="TempSetPoint">
            </div>
            <div class="col-auto">
            [mA]
          </div>
          </div>

          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <label for="Compliance" class="col-form-label">Voltage Compliance</label>
            </div>
            <div class="col-auto">
              <input type="number" min=0 max=8 step=0.1 id="Compliance" value=2 class="form-control" aria-describedby="TempSetPoint">
            </div>
            <div class="col-auto">
            [V]
          </div>
          </div>

          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <label for="NPLC" min=0.001 max=10 class="col-form-label">NPLC</label>
            </div>
            <div class="col-auto">
              <input type="number" id="NPLC" value=2 class="form-control" aria-describedby="TempSetPoint">
            </div>
          </div>

          <button type="button" class="btn btn-outline-primary btn-lg" onclick="set_transport()">Set</button>
        </div>

        <div class="Temperature col-flex rounded border border-secondary bg-light">
          <h1>Temperature</h1>
          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <label for="SetPoint" class="col-form-label">Set Point</label>
            </div>
            <div class="col-auto">
              <input type="text" id="SetPoint" class="form-control" aria-describedby="TempSetPoint">
            </div>
          </div>

          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <label for="Rate" class="col-form-label">Rate</label>
            </div>
            <div class="col-auto">
              <input type="text" id="Rate" class="form-control" aria-describedby="TempSetPoint">
            </div>
          </div>

          <button type="button" class="btn btn-outline-primary btn-lg">Set</button>
        </div>

        <script type="text/javascript">
        function change_channel(e){
          console.log(e.id,e.checked)
          id = parseFloat(e.id.replace('ch',''))

          //eel.change_channel(id,e.checked)
        }

        function set_channel(){
          const channels = [];
          if (document.getElementById("ch1").checked){
            channels.push(1)
          }
          if (document.getElementById("ch2").checked){
            channels.push(2)
          }
          if (document.getElementById("ch3").checked){
            channels.push(3)
          }
          if (document.getElementById("ch4").checked){
            channels.push(4)
          }
          //eel.set_channels(channels)
          console.log(channels)
        }
        </script>
        <div class="chSelect rounded border border-secondary bg-light">
          <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="ch1" onchange="change_channel(this)" checked>
          <label class="form-check-label" for="ch1">1</label>
          </div>

          <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="ch2" onchange="change_channel(this)" checked>
          <label class="form-check-label" for="ch2">2</label>
          </div>
          <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="ch3" onchange="change_channel(this)" checked>
          <label class="form-check-label" for="ch3">3</label>
          </div>
          <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="ch4" onchange="change_channel(this)" checked>
          <label class="form-check-label" for="ch4">4</label>
          </div>
        <button type="button" class="btn btn-outline-primary" onclick="set_channel()">Set</button>

        </div>

        <div class="FileMenu rounded border border-secondary bg-light">
          <div class="row">
            <div class="col">
              <input type="text" class="form-control" placeholder="Sample name" id="sample_name">
            </div>
            <div class="col">
              <input type="file" directory/>
            </div>
          </div>
        </div>


      <script type="text/javascript">
      //start_cont_measure(current,voltage_comp,nplc_speed,sample_name,rate,meter_196)
        function start_cont_measure(){
          //get all parameters from page
          current = parseFloat(document.getElementById("Current").value)
          compliance = parseFloat(document.getElementById("Compliance").value)
          nplc = parseFloat(document.getElementById("NPLC").value)
          sample_name = document.getElementById("sample_name").value
          //call the python function
          rate = 0.01
          eel.start_cont_measure(current,compliance,nplc,sample_name,rate)
        }

      </script>

        <div class="actions rounded border border-secondary bg-light">
          <button type="button" class="btn btn-outline-success btn-lg" onclick="start_cont_measure()">Start</button>
          <button type="button" class="btn btn-outline-danger btn-lg" onclick="eel.halt_measurement()">Stop</button>
        </div>
    </div>
  </body>
</html>
